import{_ as e,c as i,o as s,a2 as n}from"./chunks/framework.DRvQ3jNO.js";const u=JSON.parse('{"title":"Architecture","description":"","frontmatter":{},"headers":[],"relativePath":"guide/architecture.md","filePath":"guide/architecture.md"}'),t={name:"guide/architecture.md"};function l(o,a,r,p,c,h){return s(),i("div",null,[...a[0]||(a[0]=[n(`<h1 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">â€‹</a></h1><p>Mist is designed as a lightweight, monolithic application with a focus on simplicity and resource efficiency.</p><h2 id="system-design" tabindex="-1">System Design <a class="header-anchor" href="#system-design" aria-label="Permalink to &quot;System Design&quot;">â€‹</a></h2><h3 id="high-level-architecture" tabindex="-1">High-Level Architecture <a class="header-anchor" href="#high-level-architecture" aria-label="Permalink to &quot;High-Level Architecture&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Internet Traffic</span></span>
<span class="line"><span>       â†“</span></span>
<span class="line"><span>   [Traefik Proxy] â† SSL/TLS, Domain Routing</span></span>
<span class="line"><span>       â†“</span></span>
<span class="line"><span>   [App Containers] â† Your deployed applications</span></span>
<span class="line"><span>       â†‘</span></span>
<span class="line"><span>   [Mist Backend] â† Go API Server</span></span>
<span class="line"><span>       â†‘</span></span>
<span class="line"><span>   [SQLite DB] â† Application state</span></span>
<span class="line"><span>       â†‘</span></span>
<span class="line"><span>   [Frontend SPA] â† React dashboard</span></span></code></pre></div><h2 id="core-components" tabindex="-1">Core Components <a class="header-anchor" href="#core-components" aria-label="Permalink to &quot;Core Components&quot;">â€‹</a></h2><h3 id="_1-backend-api-server-go" tabindex="-1">1. Backend API Server (Go) <a class="header-anchor" href="#_1-backend-api-server-go" aria-label="Permalink to &quot;1. Backend API Server (Go)&quot;">â€‹</a></h3><p><strong>Location</strong>: <code>/server</code></p><p>The backend is a single Go binary that handles:</p><ul><li><strong>REST API</strong> - HTTP endpoints for CRUD operations</li><li><strong>WebSocket Server</strong> - Real-time updates for logs and metrics</li><li><strong>Authentication</strong> - JWT-based auth with HTTP-only cookies</li><li><strong>Deployment Queue</strong> - In-memory queue for build jobs</li><li><strong>Deployment Workers</strong> - Goroutines that process deployments</li><li><strong>Docker Integration</strong> - Direct socket communication</li><li><strong>GitHub Webhooks</strong> - Auto-deploy on push events</li></ul><p><strong>Key Features:</strong></p><ul><li>Single compiled binary</li><li>No external process managers needed</li><li>Embedded migrations</li><li>Graceful shutdown handling</li></ul><h3 id="_2-frontend-react-vite" tabindex="-1">2. Frontend (React + Vite) <a class="header-anchor" href="#_2-frontend-react-vite" aria-label="Permalink to &quot;2. Frontend (React + Vite)&quot;">â€‹</a></h3><p><strong>Location</strong>: <code>/dash</code></p><p>Modern single-page application providing:</p><ul><li>Dashboard with real-time updates</li><li>Application management interface</li><li>Deployment monitoring</li><li>Log viewer with WebSocket streaming</li><li>System metrics visualization</li></ul><p><strong>Tech Stack:</strong></p><ul><li>React 18</li><li>Vite for build tooling</li><li>Tailwind CSS for styling</li><li>Shadcn/ui components</li></ul><h3 id="_3-database-sqlite" tabindex="-1">3. Database (SQLite) <a class="header-anchor" href="#_3-database-sqlite" aria-label="Permalink to &quot;3. Database (SQLite)&quot;">â€‹</a></h3><p><strong>Location</strong>: <code>/var/lib/mist/mist.db</code></p><p>Embedded file-based database storing:</p><ul><li>Users and sessions</li><li>Projects and members</li><li>Applications</li><li>Deployments</li><li>Environment variables</li><li>Domains</li><li>Audit logs</li><li>System settings</li></ul><p><strong>Benefits:</strong></p><ul><li>No separate database server</li><li>Automatic backups (just copy the file)</li><li>ACID transactions</li><li>Zero configuration</li></ul><h3 id="_4-docker-engine" tabindex="-1">4. Docker Engine <a class="header-anchor" href="#_4-docker-engine" aria-label="Permalink to &quot;4. Docker Engine&quot;">â€‹</a></h3><p>Mist communicates with Docker via the socket (<code>/var/run/docker.sock</code>) to:</p><ul><li>Build images from Dockerfiles</li><li>Create and manage containers</li><li>Stream container logs</li><li>Monitor container status</li><li>Configure networks</li></ul><h3 id="_5-reverse-proxy-traefik" tabindex="-1">5. Reverse Proxy (Traefik) <a class="header-anchor" href="#_5-reverse-proxy-traefik" aria-label="Permalink to &quot;5. Reverse Proxy (Traefik)&quot;">â€‹</a></h3><p><strong>Location</strong>: <code>docker-compose.yml</code></p><p>Traefik handles:</p><ul><li>HTTP/HTTPS traffic routing</li><li>Domain-based routing to containers</li><li>SSL/TLS termination</li><li>Load balancing (future)</li></ul><p><strong>Configuration:</strong></p><ul><li>Dynamic configuration via Docker labels</li><li>File-based static configuration</li><li>Automatic service discovery</li></ul><h2 id="deployment-workflow" tabindex="-1">Deployment Workflow <a class="header-anchor" href="#deployment-workflow" aria-label="Permalink to &quot;Deployment Workflow&quot;">â€‹</a></h2><h3 id="_1-user-triggers-deployment" tabindex="-1">1. User Triggers Deployment <a class="header-anchor" href="#_1-user-triggers-deployment" aria-label="Permalink to &quot;1. User Triggers Deployment&quot;">â€‹</a></h3><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">User â†’ Frontend â†’ API â†’ Deployment Queue</span></span></code></pre></div><h3 id="_2-queue-processing" tabindex="-1">2. Queue Processing <a class="header-anchor" href="#_2-queue-processing" aria-label="Permalink to &quot;2. Queue Processing&quot;">â€‹</a></h3><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Simplified deployment worker</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> processDeployment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">job</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DeploymentJob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. Clone Git repository</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cloneRepo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(job.RepoURL, job.Branch)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. Build Docker image</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    buildImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(job.Dockerfile, job.BuildArgs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. Stop old container (if exists)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    stopContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(job.AppID)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. Start new container</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    startContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(job.Image, job.EnvVars, job.Port)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 5. Update Traefik routes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    updateProxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(job.Domain, job.ContainerName)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 6. Update database</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    markDeploymentComplete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(job.ID)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-real-time-updates" tabindex="-1">3. Real-time Updates <a class="header-anchor" href="#_3-real-time-updates" aria-label="Permalink to &quot;3. Real-time Updates&quot;">â€‹</a></h3><p>WebSocket connections stream:</p><ul><li>Build logs during image creation</li><li>Container logs after deployment</li><li>System metrics every second</li><li>Mist backend logs via journalctl integration</li></ul><h2 id="data-flow" tabindex="-1">Data Flow <a class="header-anchor" href="#data-flow" aria-label="Permalink to &quot;Data Flow&quot;">â€‹</a></h2><h3 id="rest-api-request" tabindex="-1">REST API Request <a class="header-anchor" href="#rest-api-request" aria-label="Permalink to &quot;REST API Request&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Frontend â†’ API Endpoint â†’ Middleware (Auth) â†’ Handler â†’ Database â†’ Response</span></span></code></pre></div><h3 id="websocket-connection" tabindex="-1">WebSocket Connection <a class="header-anchor" href="#websocket-connection" aria-label="Permalink to &quot;WebSocket Connection&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Frontend â†’ WebSocket Upgrade â†’ Auth Check â†’ Stream Data â†’ Client</span></span></code></pre></div><h3 id="deployment-flow" tabindex="-1">Deployment Flow <a class="header-anchor" href="#deployment-flow" aria-label="Permalink to &quot;Deployment Flow&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. Git Push</span></span>
<span class="line"><span>2. GitHub Webhook â†’ Mist API</span></span>
<span class="line"><span>3. Create Deployment Record</span></span>
<span class="line"><span>4. Add to Queue</span></span>
<span class="line"><span>5. Worker Picks Up Job</span></span>
<span class="line"><span>6. Clone Repo</span></span>
<span class="line"><span>7. Build Docker Image (stream logs via WebSocket)</span></span>
<span class="line"><span>8. Start Container</span></span>
<span class="line"><span>9. Update Traefik Config</span></span>
<span class="line"><span>10. Mark Deployment Complete</span></span>
<span class="line"><span>11. Notify Frontend via WebSocket</span></span></code></pre></div><h2 id="security-architecture" tabindex="-1">Security Architecture <a class="header-anchor" href="#security-architecture" aria-label="Permalink to &quot;Security Architecture&quot;">â€‹</a></h2><h3 id="authentication" tabindex="-1">Authentication <a class="header-anchor" href="#authentication" aria-label="Permalink to &quot;Authentication&quot;">â€‹</a></h3><ul><li>JWT tokens stored in HTTP-only cookies</li><li>Refresh token rotation</li><li>Session management</li><li>Password hashing with bcrypt</li></ul><h3 id="authorization" tabindex="-1">Authorization <a class="header-anchor" href="#authorization" aria-label="Permalink to &quot;Authorization&quot;">â€‹</a></h3><ul><li>Role-based access control (admin, user)</li><li>Project-level permissions</li><li>Owner-only operations</li></ul><h3 id="api-security" tabindex="-1">API Security <a class="header-anchor" href="#api-security" aria-label="Permalink to &quot;API Security&quot;">â€‹</a></h3><ul><li>Rate limiting (planned)</li><li>CORS configuration</li><li>Input validation</li><li>SQL injection prevention (parameterized queries)</li><li>XSS protection</li></ul><h2 id="monitoring-observability" tabindex="-1">Monitoring &amp; Observability <a class="header-anchor" href="#monitoring-observability" aria-label="Permalink to &quot;Monitoring &amp; Observability&quot;">â€‹</a></h2><h3 id="logging-architecture" tabindex="-1">Logging Architecture <a class="header-anchor" href="#logging-architecture" aria-label="Permalink to &quot;Logging Architecture&quot;">â€‹</a></h3><p><strong>Container Logs:</strong></p><ul><li>Streamed from Docker via socket connection</li><li>Real-time delivery via WebSocket to frontend</li><li>Last 100 lines buffered on connection</li></ul><p><strong>System Logs:</strong></p><ul><li>Mist backend logs collected via systemd journal</li><li>Accessed through <code>journalctl</code> integration</li><li>Live streaming to <code>/logs</code> page</li><li>Includes all Go backend output (API, deployments, errors)</li></ul><p><strong>Build Logs:</strong></p><ul><li>Written to filesystem during Docker builds</li><li>Path: <code>/var/lib/mist/logs/&lt;deployment-id&gt;.log</code></li><li>Accessible through deployment details</li></ul><h3 id="metrics-collection" tabindex="-1">Metrics Collection <a class="header-anchor" href="#metrics-collection" aria-label="Permalink to &quot;Metrics Collection&quot;">â€‹</a></h3><p><strong>System Metrics:</strong></p><ul><li>CPU usage (percentage)</li><li>Memory usage (used/total)</li><li>Disk usage (used/total)</li><li>Updated every second via WebSocket</li></ul><p><strong>Container Metrics:</strong></p><ul><li>Container state (running/stopped/error)</li><li>Container uptime</li><li>Basic container information</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Advanced per-container metrics (CPU, memory, network I/O) are planned for future releases.</p></div><h2 id="scalability-considerations" tabindex="-1">Scalability Considerations <a class="header-anchor" href="#scalability-considerations" aria-label="Permalink to &quot;Scalability Considerations&quot;">â€‹</a></h2><h3 id="current-design-single-server" tabindex="-1">Current Design (Single Server) <a class="header-anchor" href="#current-design-single-server" aria-label="Permalink to &quot;Current Design (Single Server)&quot;">â€‹</a></h3><p>âœ… <strong>Strengths:</strong></p><ul><li>Simple deployment</li><li>No complex networking</li><li>Easy to debug</li><li>Low resource usage</li></ul><p>âš ï¸ <strong>Limitations:</strong></p><ul><li>Single point of failure</li><li>Limited to one server&#39;s resources</li><li>No horizontal scaling</li></ul><h3 id="future-improvements" tabindex="-1">Future Improvements <a class="header-anchor" href="#future-improvements" aria-label="Permalink to &quot;Future Improvements&quot;">â€‹</a></h3><p>ğŸš§ <strong>Planned:</strong></p><ul><li>Multi-node support with Docker Swarm</li><li>Database replication</li><li>Load balancing</li><li>Shared storage for builds</li></ul><h2 id="file-system-layout" tabindex="-1">File System Layout <a class="header-anchor" href="#file-system-layout" aria-label="Permalink to &quot;File System Layout&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/var/lib/mist/</span></span>
<span class="line"><span>â”œâ”€â”€ mist.db              # SQLite database</span></span>
<span class="line"><span>â”œâ”€â”€ repos/               # Cloned Git repositories</span></span>
<span class="line"><span>â”‚   â””â”€â”€ &lt;app-id&gt;/       </span></span>
<span class="line"><span>â”‚       â””â”€â”€ &lt;repo&gt;/     </span></span>
<span class="line"><span>â”œâ”€â”€ builds/              # Build artifacts</span></span>
<span class="line"><span>â”‚   â””â”€â”€ &lt;deployment-id&gt;/</span></span>
<span class="line"><span>â””â”€â”€ logs/                # Build logs</span></span>
<span class="line"><span>    â””â”€â”€ &lt;deployment-id&gt;.log</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/etc/mist/</span></span>
<span class="line"><span>â”œâ”€â”€ config.yml           # Mist configuration</span></span>
<span class="line"><span>â””â”€â”€ traefik/             # Traefik configs</span></span>
<span class="line"><span>    â”œâ”€â”€ traefik.yml</span></span>
<span class="line"><span>    â””â”€â”€ dynamic/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>/usr/local/bin/</span></span>
<span class="line"><span>â””â”€â”€ mist                 # Mist binary</span></span></code></pre></div><h2 id="performance-characteristics" tabindex="-1">Performance Characteristics <a class="header-anchor" href="#performance-characteristics" aria-label="Permalink to &quot;Performance Characteristics&quot;">â€‹</a></h2><h3 id="resource-usage" tabindex="-1">Resource Usage <a class="header-anchor" href="#resource-usage" aria-label="Permalink to &quot;Resource Usage&quot;">â€‹</a></h3><p><strong>Idle State:</strong></p><ul><li>CPU: &lt; 1%</li><li>RAM: ~50-100MB</li><li>Disk: ~100MB</li></ul><p><strong>Under Load (10 concurrent deployments):</strong></p><ul><li>CPU: 10-30%</li><li>RAM: ~200-500MB</li><li>Disk: Depends on app sizes</li></ul><h3 id="benchmarks" tabindex="-1">Benchmarks <a class="header-anchor" href="#benchmarks" aria-label="Permalink to &quot;Benchmarks&quot;">â€‹</a></h3><ul><li>API Response Time: &lt; 50ms (p95)</li><li>WebSocket Latency: &lt; 10ms</li><li>Concurrent Users: 100+</li><li>Apps per Instance: 1000+</li></ul><h2 id="technology-choices" tabindex="-1">Technology Choices <a class="header-anchor" href="#technology-choices" aria-label="Permalink to &quot;Technology Choices&quot;">â€‹</a></h2><h3 id="why-go" tabindex="-1">Why Go? <a class="header-anchor" href="#why-go" aria-label="Permalink to &quot;Why Go?&quot;">â€‹</a></h3><ul><li>Fast compilation and execution</li><li>Excellent concurrency (goroutines)</li><li>Single binary deployment</li><li>Strong standard library</li><li>Great Docker SDK</li></ul><h3 id="why-sqlite" tabindex="-1">Why SQLite? <a class="header-anchor" href="#why-sqlite" aria-label="Permalink to &quot;Why SQLite?&quot;">â€‹</a></h3><ul><li>Zero configuration</li><li>Embedded database</li><li>ACID compliance</li><li>Perfect for single-server deployments</li><li>Easy backups (copy file)</li></ul><h3 id="why-traefik" tabindex="-1">Why Traefik? <a class="header-anchor" href="#why-traefik" aria-label="Permalink to &quot;Why Traefik?&quot;">â€‹</a></h3><ul><li>Dynamic configuration</li><li>Docker integration</li><li>Automatic service discovery</li><li>Let&#39;s Encrypt support</li><li>Modern and actively maintained</li></ul><h2 id="learn-more" tabindex="-1">Learn More <a class="header-anchor" href="#learn-more" aria-label="Permalink to &quot;Learn More&quot;">â€‹</a></h2><ul><li><a href="./deployments.html">Deployment Process</a></li><li><a href="./../deployment/traefik.html">Traefik Configuration</a></li></ul>`,97)])])}const g=e(t,[["render",l]]);export{u as __pageData,g as default};
